version: 3.13.1
date: 2025-03-20
relnotes:
-   summary: Improve behavior of the backup shortcuts `last-full` / `latest-full`
    description: |-
        The shortcuts `last-full` / `latest-full` were retrieving not the last full backup of
        the server, but the last full backup of the server which was eligible as the parent
        for an incremental backup.

        While this was the expected behavior, the feedback from the community has shown that
        it was confusing for the users.

        From now on, the shortcuts `last-full` / `latest-full` will retrieve the last full
        backup of the Barman server, independently if that backup is eligible as the parent
        for an incremental backup or not.

        The eligibility of the full backup as the parent of an incremental backup will still
        be validated by Barman in a later step, and a proper message will be displayed in
        case it doesn't suit as a parent.
    jira_tickets:
    - BAR-555
    support_tickets: []
    type: minor_change
-   summary: Fix error message when parsing invalid `--target-time` in `barman restore`
    description: |-
        When using the `barman restore` command, the error message when parsing invalid
        `--target-time` string was:

        ```
        EXCEPTION: local variable 'parsed_target' referenced before assignment
        ````

        That exception was replaced with an understandable error message.
    jira_tickets:
    - BAR-627
    support_tickets: []
    type: bugfix
-   summary: Fix mutual exclusive arguments in the cloud restore command
    description: |-
        In the `barman-cloud-restore` command, we were checking that `target_tli` and
        `target_lsn` were mutually exclusive arguments, where the correct pair to check
        would be `target_time` and `target_lsn`.
    jira_tickets:
    - BAR-624
    support_tickets: []
    type: bugfix
-   summary: Fix Barman not honoring `custom_decompression_filter`
    description: |-
        Fixed an issue where Barman was not honoring the configured
        `custom_decompression_filter` if the compression algorithm specified
        was natively supported by Barman. Custom filters now take priority
        over native handlers when decompressing WAL files.
    jira_tickets:
    - BAR-584
    support_tickets: []
    type: bugfix
-   summary: Fix barman restore with --no-get-wal and --standby
    description: |-
        Fixed an issue where Barman was removing the `pg_wal` directory during
        recovery if `--no-get-wal` and `--standby-mode` were specified together.
        The issue happened due to Barman incorrectly filling the recovery parameters
        referencing `pg_wal`, including `recovery_end_command`, which led to this
        issue. Barman will now ignore filling such parameters as they are not required
        for this specific case.
    jira_tickets:
    - BAR-630
    support_tickets: []
    type: bugfix
-   summary: Fix argument parsing issue in `barman restore` and `barman-cloud-restore`
    description: |-
        In Barman 3.13.0, a regression was introduced causing errors when using
        `barman restore` and `barman-cloud-restore` commands. Specifically, the
        `backup_id` positional argument, which was made optional in that version,
        conflicted with other arguments, causing unrecognized arguments and errors.

        For example, running `barman-cloud-restore` like this:
        ```
        barman-cloud-restore source_url server_name backup_id --cloud-provider aws-s3 recovery_dir
        ```

        Would trigger an error like this:
        ```
        barman-cloud-restore: error: unrecognized arguments: recovery_dir
        ```

        This fix resolves the issue by making `backup_id` a required argument
        again. Additionally, a new "auto" value is now accepted as a `backup_id`,
        allowing Barman to automatically choose the best backup for restoration
        without needing a specific `backup_id`. This update fixes argument handling
        and still allows a smooth and flexible restoration process for the user.
    jira_tickets:
    - BAR-596
    support_tickets: []
    type: bugfix
